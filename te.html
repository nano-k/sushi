<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>検閲世界</title>

  <link rel="stylesheet" href="css/style.css">

  <style>
    /* --- イントロ演出専用CSS（本編とは独立） --- */
    #introMosaic {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      pointer-events: none;
    }

    #introText {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-family: "Hiragino Mincho ProN", "MS Mincho", serif;
      color: black;
      opacity: 0;
      transition: opacity 1.2s linear;
      z-index: 9999;
      pointer-events: none;
    }

    body.intro-active {
      overflow: hidden;
    }
  </style>
</head>

<body class="intro-active">

<!-- ▼ イントロ演出（モザイク + テキスト） ▼ -->
<canvas id="introMosaic"></canvas>
<div id="introText">検閲世界</div>
<!-- ▲ イントロ演出ここまで ▲ -->

<header>検閲世界</header>

<div class="container">
<main>
  <section class="page" data-page="1">
    <h2 class="section-title">イントロダクション</h2>
    <p>
      あなたが目を覚ましたのは、文字だらけの奇妙な世界。<br>
      文字にはどこか違和感があることにあなたは気付く。<br><br>
      あなたに与えられた能力は文字を修正する力。<br>
      文字を正しく修正して謎を解き、この歪んだ世界から帰還せよ。
    </p>

    <div class="next-btn-wrap">
      <a class="next-btn" href="world.html">進む</a>
    </div>
  </section>
</main>

<footer>
  Page <span id="pageNum">1</span>
</footer>
</div>

<script src="js/script.js"></script>

<!-- イントロ演出JS -->
<script>
/* ------------------------------
   モザイク → 検閲世界 → 消える
------------------------------- */
const canvas = document.getElementById("introMosaic");
const ctx = canvas.getContext("2d");
const textEl = document.getElementById("introText");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let tileSize = 140;
const limitSize = 6;
const shrinkRate = 0.90;

function tileColor() {
  const v = Math.random();
  if (v > 0.66) return "#111";
  if (v > 0.33) return "#333";
  return "#555";
}

function draw(size) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < canvas.height; y += size) {
    for (let x = 0; x < canvas.width; x += size) {
      ctx.fillStyle = tileColor();
      ctx.fillRect(x, y, size, size);
    }
  }
}

let showedText = false;
let textHidden = false;

function animate() {
  draw(tileSize);
  tileSize *= shrinkRate;

  // テキスト出現
  if (!showedText && tileSize < 40) {
    textEl.style.opacity = 1;
    showedText = true;

    // 少し待ってからフェードアウト
    setTimeout(() => {
      textEl.style.transition = "opacity 0.8s linear";
      textEl.style.opacity = 0;

      setTimeout(() => {
        if (!textHidden) {
          textEl.remove();
          textHidden = true;
        }
      }, 900);

    }, 1200);
  }

  // モザイク終了
  if (tileSize <= limitSize) {
    setTimeout(() => {
      canvas.style.transition = "opacity 1s linear";
      canvas.style.opacity = 0;

      setTimeout(() => {
        canvas.remove();
        document.body.classList.remove("intro-active");
      }, 1200);
    }, 500);

    return;
  }

  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
