<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>検閲世界</title>

<style>
  body {
    margin: 0;
    background: #fff;
    font-family: "Hiragino Mincho ProN", "MS Mincho", serif;
    overflow: hidden;
  }

  #text {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: black;
    opacity: 0;
    transition: opacity 1.2s linear;
    pointer-events: none;
  }

  #mosaic {
    position: fixed;
    top: 0;
    left: 0;
  }
</style>

</head>
<body>

<canvas id="mosaic"></canvas>
<div id="text">検閲世界</div>

<script>
const canvas = document.getElementById("mosaic");
const ctx = canvas.getContext("2d");
const textEl = document.getElementById("text");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let tileSize = 140;
const limitSize = 6;
const shrinkRate = 0.90;

function tileColor() {
  const v = Math.random();
  if (v > 0.66) return "#111";
  if (v > 0.33) return "#333";
  return "#555";
}

function draw(size) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < canvas.height; y += size) {
    for (let x = 0; x < canvas.width; x += size) {
      ctx.fillStyle = tileColor();
      ctx.fillRect(x, y, size, size);
    }
  }
}

let showedText = false;
let textHidden = false;

function animate() {
  draw(tileSize);
  tileSize *= shrinkRate;

  // テキスト表示（絶対発火）
  if (!showedText && tileSize < 40) {
    textEl.style.opacity = 1;
    showedText = true;

    // 一定時間後に自動でフェードアウト
    setTimeout(() => {
      textEl.style.transition = "opacity 0.8s linear";
      textEl.style.opacity = 0;

      // 完全に消えたら削除
      setTimeout(() => {
        if (!textHidden) {
          textEl.remove();
          textHidden = true;
        }
      }, 900);

    }, 1200);
  }

  // モザイク終了
  if (tileSize <= limitSize) {
    setTimeout(() => {
      canvas.style.transition = "opacity 1s linear";
      canvas.style.opacity = 0;

      setTimeout(() => {
        canvas.remove();
      }, 1200);
    }, 500);

    return;
  }

  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
